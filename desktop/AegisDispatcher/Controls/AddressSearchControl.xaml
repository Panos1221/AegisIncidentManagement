<UserControl x:Class="AegisDispatcher.Controls.AddressSearchControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="200" d:DesignWidth="400">

    <UserControl.Resources>
        <Style x:Key="SearchButton" TargetType="Button">
            <Setter Property="Background" Value="#FF007ACC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="0,4,4,0"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF1F8AD6"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#FF005A9E"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#FF626262"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SearchTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="BorderThickness" Value="1,1,0,1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4,0,0,4">
                            <ScrollViewer x:Name="PART_ContentHost" 
                                         Margin="{TemplateBinding Padding}"
                                         VerticalAlignment="{TemplateBinding VerticalContentAlignment}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ResultsListBox" TargetType="ListBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#FFCCCCCC"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="MaxHeight" Value="200"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
        </Style>

        <Style x:Key="ResultItem" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="BorderBrush" Value="#FFF0F0F0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FFF5F5F5"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="#FFE3F2FD"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Input Row -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <TextBox x:Name="SearchTextBox" 
                     Grid.Column="0"
                     Style="{StaticResource SearchTextBox}"
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     KeyDown="SearchTextBox_KeyDown"
                     GotFocus="SearchTextBox_GotFocus"
                     LostFocus="SearchTextBox_LostFocus"/>

            <Button x:Name="SearchButton" 
                    Grid.Column="1"
                    Style="{StaticResource SearchButton}"
                    Click="SearchButton_Click"
                    ToolTip="Search for address">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🔍" FontSize="14" Margin="0,0,4,0"/>
                    <TextBlock Text="Search" FontSize="12"/>
                </StackPanel>
            </Button>
        </Grid>

        <!-- Search Results Dropdown -->
        <Border Grid.Row="1" 
                x:Name="ResultsContainer"
                Visibility="Collapsed"
                Margin="0,2,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Loading Indicator -->
                <Border Grid.Row="0" 
                        x:Name="LoadingIndicator"
                        Background="#FFF9F9F9"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Padding="10,8"
                        Visibility="Collapsed">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="🔄" FontSize="12" Margin="0,0,8,0"/>
                        <TextBlock Text="Searching..." FontSize="12" Foreground="#FF666666"/>
                    </StackPanel>
                </Border>

                <!-- Results List -->
                <ListBox Grid.Row="1"
                         x:Name="ResultsListBox"
                         Style="{StaticResource ResultsListBox}"
                         ItemContainerStyle="{StaticResource ResultItem}"
                         SelectionChanged="ResultsListBox_SelectionChanged"
                         MouseDoubleClick="ResultsListBox_MouseDoubleClick">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel>
                                <TextBlock Text="{Binding DisplayName}" 
                                          FontWeight="SemiBold" 
                                          FontSize="12"
                                          TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding FormattedAddress}" 
                                          FontSize="11" 
                                          Foreground="#FF666666"
                                          TextWrapping="Wrap"
                                          Margin="0,2,0,0"/>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- No Results Message -->
                <Border Grid.Row="1"
                        x:Name="NoResultsMessage"
                        Background="White"
                        BorderBrush="#FFCCCCCC"
                        BorderThickness="1"
                        Padding="10,15"
                        Visibility="Collapsed">
                    <StackPanel HorizontalAlignment="Center">
                        <TextBlock Text="❌" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,5"/>
                        <TextBlock Text="No addresses found" 
                                  FontSize="12" 
                                  Foreground="#FF666666"
                                  HorizontalAlignment="Center"/>
                        <TextBlock Text="Try a different search term" 
                                  FontSize="11" 
                                  Foreground="#FF999999"
                                  HorizontalAlignment="Center"
                                  Margin="0,2,0,0"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>